# 5. AWS ROUTE 53
###### tags: `aws` `aws-saa`

## Over view
- A highly available, scalable, fully managed and Authoritative DNS
	- Authoritative = the customer(you) can update the DNS records
- Route 53 is also a Domian Register
- Ability to check the health of your resources
- The only AWS service which provides 100% availability SLA
- Why Route 53? 53 is a reference to the traditional DNS port

### Route 53 - Records
- How you want to route traffic for for a domain
- Each record cotains:
	- Domain/subdomain Name - e.g., example.com
	- Record Type - e.g., A or AAAA
	- Value - e.g., 12.34, 56.78
	- Routing Policy - how Route 53 responds to queries
	- TTL - amount of time the record cached at DNS Resolvers
- Route 54 supports the following DNS record types:
	- (__**must know**__) A/ AAAA/ CNAME/ NS
	- (advanced) CAA/ DS/ MX/ NAPIR/ PTR/ SOA/ TXT/ SPF/ SRV

### Record Types - Record Type
- A - maps a hostname to IPv4
- AAAA - maps a hostname to IPv6
- CNAME - maps a hostname to another hostname
	- The target is a domain name which must have an A or AAAA record
	- Can not create a CNAME reocord for the top node of a DNS namespace(Zone Apex)
	- Example: you can not create for example.com, but you can create for www.example.com
- NS - Name Servers for the Host Zone
	- Control how traffic is routed for a domain

### Route 53 - Hosted Zones
- A container for records that define how to roue traffic to a domain and it's subdomain
- Pulic Hosted Zones - contains records that specify how to route traffic on the Internet (public domain names)
- Private Hosted Zones - contain records that specify how you route traffic within one or more VPCs(private domain names)
- You pay $0.5 per month hosted zone

### Route 53 - Public vs. Private Host Zones
![](https://i.imgur.com/UQNZqFU.png)

### Route 53 - Recods TTL (Time To Live)
![](https://i.imgur.com/N7fVJSJ.png)

## CANE vs Alias
- AWS Resources(Load Balancer, CloudFront...) expose an AWS hostname:
	- lbl-1234.us-east-2.elb-amazonaws.com and you want myapp.mydomain.com

- CNAME:
	- Points a hostname to any other hostname. (app.mydomain.com => blabla.anything.com)
	- __**Only for non root domain(aka. something.mydomain.com)**__
- Alias:
	- Points a hostname to an AWS Resource(app.mydomain.com => blabla.amazonaws.com)
	- __**Works for root domain and non root domain(aka. mydomain.com)**__
	- free of charge
	- Native health check

### Route 53 - Alias Records
- Maps a hostname to an AWS resource
- An extension to DNS functionality
- Automatically recognizes changes in the resource's IP addresses
- Unlike CNAME, it can be used for the top node of a DNS namespace (Zone Apex), e.g.: example.com
- Alias Record is always of type A/AAAA for AWS resources (IPv4/6)
- __**You can not set the TTL**__

### Route 53 - Alias Records Targets
- Elastic Load Balancers
- CloudFront Distributions
- API Gateway
- Elastic Beanstalk environments
- S3 Websites
- VPC Interface Endpoints
- Global Accelerator accelerator
- Route 53 record in the same hosted zone
- __**You can not set an ALIAS record for an EC2 DNS name**__

## Route 53 - Routing Policies
- Define how Route 53 responds to DNS queries
- Don't get confused by the word "Routing"
	- It's not the same as Load balancer routing which routes the traffic
	- DNS does not route any traffic, it only responds to the DNS queries
- Route 53 Supports the following Routing Policies
	- Simple
	- Weighted
	- Failover
	- Latency base
	- Geolocation
	- Multi-Calue Answer
	- Geoproximity (using Route 53 Traffic Flow feature)

### Routing Polices - Simple
- Typically, route traffic to a single resource
- Can specify multiple values in the same record
- **If multiple values are returned, a random one is chosen by the __client__**
- When Alias enabled, specify only one AWS resource
- Can't be associated with Health Check

### Routing Policies - Weighted
- Control the % of the requests to that ge to each specific resource
- Assign each record a relative weight
	- traffic (%) = Weight for a specific record/sum of all the weights for all records
	- Weights don't need to sum up to 100
- DNS records must have the same name and type 
- Can be associated with Health Checks
- Use cases: load balancing between regions, testing new application version(金絲雀更版模式)...
- **Assign a weight of 0 to a record to stop sending traffic to a resource**
- If all records have weight of 0, then all records will be returned equally

### Routing Policies - Latency-base
- Redirect to the resource that has the least latency close to us
- Super helpful when latency for users is priority
- **Latency is based on traffic between users and the AWS Regions**
- Can be associated wieh Health Checks(has a failover capability) 
 ![](https://i.imgur.com/8ILlQMk.png)
 
### Routing Policies - Failover (Active-Passive) 
- You will have two target(Primary/ Secondary)
- Route 53 will health check Primary target mandatory
![](https://i.imgur.com/4wCdK2k.png)

### Routing Policies - Geolocation
- Different from Latency-based!
- **This routing is based on user location**
- Specify location by Contient, Country or by US State (if there's overlapping, most precies location selected)
- Should create a "Deafault" record(in case there's no match on location)
- Use cases: website localiztion, restrict content distribution, load balacing...
- Can associated with Health Checks
![](https://i.imgur.com/8LPpAJq.png)

### Routing Policies - Geoproximity Routing Policy 
- Route traffic to your resources based on the geographic location of users and resources
- Ability to shift more traffic to resources based on the defined **bias**
- To change the size of the geographic region, specify **bias** values:
	- To expand (1 to 99) - more traffic to the resource
	- To shrink (-1 to -99) - less traffic to the resource
- Resources can be:
	- AWS resources (specify AWS region)
	- Non-AWS resources (specify Latitude and Longitude)
- You must use Route 53 **Traffic Flow** (advanced) to use this feature
 ![](https://i.imgur.com/wQzGkVO.png)

### Routing Polices - Multi-Value
- Use when routing traffic to multiple resoures
- Route 53 return multiple values/resources
- Can be associated with Health Checks (return only values for healthy resources)
- Up to **8** healthy records are returned for each Mulit-Value query
- Mulit-Value is not a substitute for having an ELB

## Route 53 - Health Checks
- HTTP Health Checks are only for public resources
- Health Check => Automated DNS Failover:
	- Health checks that monitor an endpoint (application, server, other AWS resource)
	- Healht checks that monitor other health checks (Calculate Health Checks)
	- Health checks that monitor CloudWatch Alarms (__**full controll**__) - e.g.: throttles of DynamoDB, alarms on RDS, custom metrics... (helpful for private resources)
- Health Checks are integrated with CW metrics

### Health Checks - Monitor an Endpoint
- About 15 global health checkers will check the endpoint health
	- Healthy/Unhealthy Threshold - 3(default)
	- Interval - 30 sec(can set to 10s - higher cost)
	- if > 18% of health checkers report the endpoint is healthy, Route 53 considers it **Healthy**. Otherwise, it's **Unhealthy**
	- Ability to choose which locations you want Route 53 to use
- Health Checks pass only when the endpoint responds with the 2xx and 3xx status codes
- Health Checks can bet setup to pass/ fail based on the text in the first 5120 bytes of the response
- Configure you router/firewall to allow incoming requests from Route 53 Health Checkers

### Health Checks - Calculated Health Checks
- Combine the results of multiple Health Checks into a single Health Check
- You can use OR, AND or NOT
- Can monitor up to 256 Child Health Checks 
- Specify how many of the health checks need to pass to make the parent pass
- Usage: perform maintenace to your website without causing all health checks to fail
 ![](https://i.imgur.com/QI890Ka.png)

### Health Checks - Private Hosted Zones
- Route 53 health checkers are outside the VPC
- They can not access private endpoints(private VPC or on-premises resource)
- You can create a CloudWatch Metric and associate a CloudWatch Alarm, then create a Health Check that checks the alarm itself
 ![](https://i.imgur.com/06tQwZg.png)


## Route 53 - Traffic flow
- Simplify the process of creating and maintaining records in large and complex configurations
- Visual editor to manage complex routing decision trees
- Configurations can be saved as Traffic Flow Policy
	- Can be applied to different Route 53 Host Zones (different domain names)
	- Supports versioning
![](https://i.imgur.com/SeD44rL.png)

## Domain Registar vs. DNS Service
- You buy or register your domain name with a Domain Registrar typically by paying annual charges (e.g., GoDaddy, Amazon Registrar Inc,...)
- The Domain Registrar usually provides you with a DNS service to manage your DNS records
- But you can use another DNS service to manage your DNS records
- Example: purchase the domain from GoDaddy and use Route 53 to manage your DNS records

![](https://i.imgur.com/IN3wfjf.png)

### 3rd Party Registrar with Amazon Route 53
- If you buy your domain on a 3rd party registrar, you can still use Route 53 as the DNS Service provider
	1. Create a Host Zone in Route 53
	2. Update NS Records on 3rd party website to use Route 53 Name Servers

- **Domain Registrar != DNS Service**